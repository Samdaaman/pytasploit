import os
import pty
import subprocess
from threading import Thread
from time import sleep
from typing import IO

init_script = subprocess.Popen("docker-entrypoint.sh mysqld", stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True)

print("Waiting for mysql to initalise")

while 'MySQL init process done. Ready for start up' not in init_script.stdout.readline().decode():
    print('.', end='')
    sleep(0.2)

print()
print('msql started')
init_script.kill()
os.system('pkill mysqld')

mysqld = subprocess.Popen("mysqld", stdout=subprocess.PIPE, stderr=subprocess.PIPE)

print(f'mysqld started with PID={mysqld.pid}')
sleep(3)
print('-' * 50)
os.system("su -c 'python3 exploit.py' sam")

# subprocess.run(['python3', 'exploit.py'], timeout=10)

# print(f'exploit finished')